name: Continuous integration
on:
  push:
    branches:
      - master
  pull_request:
    branches:
      - master

# GitHub Actions usage is FREE for both public repositories and self-hosted runners.
# We can use it to build our project and do some automated builds and in future quality tests.
# https://docs.github.com/en/billing/managing-billing-for-github-actions/about-billing-for-github-actions

jobs:
  release:
    name: build translations
    runs-on: windows-2022
    timeout-minutes: 10
    steps:
      # checkout project
      - uses: actions/checkout@v3

      # setup go
      - uses: actions/setup-go@v3
        with:
          go-version: '^1.17'

      # build master
      - name: Build translations for master
        if: ${{ github.ref == 'refs/heads/master' }}
        working-directory: utils
        run: |
          go run . | grep -v 'go: ' > ../PROGRESS.md

      # commit progress for master
      - if: ${{ github.ref == 'refs/heads/master' }}
        uses: EndBug/add-and-commit@v9
          with:
            message: '[CI] update translation progress'
            default_author: github_actions
            add: 'PROGRESS.md'

      # build pull request
      - name: Build translations for pull request
        if: ${{ github.ref != 'refs/heads/master' }}
        working-directory: utils
        run: |
          go run .
          git status
          git diff
